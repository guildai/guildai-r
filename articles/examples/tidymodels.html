<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="guildai">
<title>Tidymodels with Guild AI • guildai</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Tidymodels with Guild AI">
<meta property="og:description" content="guildai">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">guildai</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../articles/guildai.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../../articles/examples/keras.html">keras</a>
    <a class="dropdown-item" href="../../articles/examples/xgboost.html">xgboost</a>
    <a class="dropdown-item" href="../../articles/examples/tidymodels.html">tidymodels</a>
    <a class="dropdown-item" href="../../articles/examples/mlr3.html">mlr3</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/guildai/guildai-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tidymodels with Guild AI</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/guildai/guildai-r/blob/HEAD/vignettes/examples/tidymodels.Rmd" class="external-link"><code>vignettes/examples/tidymodels.Rmd</code></a></small>
      <div class="d-none name"><code>tidymodels.Rmd</code></div>
    </div>

    
    
<p>Here is an example showing how to use <em>guildai</em> with
tidymodels in R.</p>
<p>If this is your first exposure to <em>guildai</em>, we recommend
starting with the framework agnostic “Getting Started” guide. This
example assumes familiarity with guild concepts like <em>flags</em> and
<em>scalars</em>.</p>
<p>We’ll start with an example R script, named “train-tidymodels.R”,
that trains, evaluates, and saves an tidymodels model using the “Ames
Housing” dataset. Here is what it looks like:</p>
<div class="cell" file="train-tidymodels.R">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://butcher.tidymodels.org/" class="external-link">butcher</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/" class="external-link">bestNormalize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/sessioninfo#readme" class="external-link">sessioninfo</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Boilerplate options -------------------------------------------------</span></span>
<span><span class="fu">tidymodels_prefer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>pillar.advice <span class="op">=</span> <span class="cn">FALSE</span>, pillar.min_title_chars <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Setup and partition data --------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"_Cond"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_not_test</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_rs</span> <span class="op">&lt;-</span> <span class="fu">validation_split</span><span class="op">(</span><span class="va">ames_not_test</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">analysis</span><span class="op">(</span><span class="va">ames_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ames_val</span> <span class="op">&lt;-</span> <span class="fu">assessment</span><span class="op">(</span><span class="va">ames_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flags ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">#| description: spline degrees of freedom for longitude</span></span>
<span><span class="co">#| min: 2</span></span>
<span><span class="co">#| max: 50</span></span>
<span><span class="va">longitude_df</span> <span class="op">&lt;-</span> <span class="fl">40L</span></span>
<span></span>
<span><span class="co">#| description: spline degrees of freedom for latitude</span></span>
<span><span class="co">#| min: 2</span></span>
<span><span class="co">#| max: 50</span></span>
<span><span class="va">latitude_df</span> <span class="op">&lt;-</span> <span class="fl">40L</span></span>
<span></span>
<span><span class="co">#| description: L2 penalty</span></span>
<span><span class="co">#| min: 0.0</span></span>
<span><span class="co">#| max: 1.0</span></span>
<span><span class="va">pen_val</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span></span>
<span><span class="co">#| description: Mixture of L1 and L2 penalty</span></span>
<span><span class="co">#| min: 0.0</span></span>
<span><span class="co">#| max: 1.0</span></span>
<span><span class="va">mix_val</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span></span>
<span><span class="co"># Recipe and Workflow -------------------------------------------------</span></span>
<span></span>
<span><span class="va">ames_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="va">MS_SubClass</span>, <span class="va">MS_Zoning</span>, <span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_orderNorm</span><span class="op">(</span><span class="va">Lot_Area</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_SF"</span><span class="op">)</span>, <span class="va">Gr_Liv_Area</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Central"</span><span class="op">)</span><span class="op">:</span><span class="va">Year_Built</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># NOTE We splice the values in via !! so that the step uses their values</span></span>
<span>  <span class="co"># and not a reference to global variables (a very bad idea)</span></span>
<span>  <span class="fu">step_spline_natural</span><span class="op">(</span><span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">longitude_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_spline_natural</span><span class="op">(</span><span class="va">Latitude</span>, deg_free <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">latitude_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmn_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">pen_val</span>, mixture <span class="op">=</span> <span class="va">mix_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">glmn_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">ames_wflow</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span>
<span><span class="va">ames_fit</span></span>
<span></span>
<span><span class="co"># fit -----------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">glmnet_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_pred</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glmnet_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">pen_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">autoplot</span><span class="op">(</span>best_penalty <span class="op">=</span> <span class="va">pen_val</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Validation set results ----------------------------------------------</span></span>
<span></span>
<span><span class="va">ames_pred</span> <span class="op">&lt;-</span> <span class="fu">augment</span><span class="op">(</span><span class="va">ames_fit</span>, <span class="va">ames_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"green"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_obs_pred</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Observed (log-10)"</span>, y <span class="op">=</span> <span class="st">"Predicted (log-10)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">val_results</span> <span class="op">&lt;-</span> <span class="va">ames_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">metrics</span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'validation_rmse:'</span>, <span class="va">val_results</span><span class="op">$</span><span class="va">.estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'validation_R2:'</span>, <span class="va">val_results</span><span class="op">$</span><span class="va">.estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'num_predictors:'</span>, <span class="va">glmnet_pred</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save object ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># butcher the objects to make their install sizes smaller</span></span>
<span><span class="va">ames_fit</span> <span class="op">&lt;-</span> <span class="fu">butcher</span><span class="op">(</span><span class="va">ames_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save objects in the current working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">ames_fit</span>, <span class="va">val_results</span>, file <span class="op">=</span> <span class="st">".RData"</span>,</span>
<span>     compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>A few things to note about the script:</p>
<ul>
<li>There is no ‘guildai’ specific configuration in the script code.
It’s a regular R script, that you can safely <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> or
work with interactively at the REPL.</li>
<li>We declare some constraints on the flag values we’ve defined.</li>
<li>At the end of the run, we save the model. This file artifacts will
be stored as part of the run, enabling us to restore a trained
model.</li>
</ul>
<p>With our script defined, we can launch a guild run and view it:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://guildai.github.io/guildai-r/">guildai</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"train-tidymodels.R"</span><span class="op">)</span></span>
<span><span class="co">## &gt; library(tidymodels)</span></span>
<span><span class="co">## ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</span></span>
<span><span class="co">## ✔ broom        1.0.3     ✔ recipes      1.0.5</span></span>
<span><span class="co">## ✔ dials        1.1.0     ✔ rsample      1.1.1</span></span>
<span><span class="co">## ✔ dplyr        1.1.0     ✔ tibble       3.1.8</span></span>
<span><span class="co">## ✔ ggplot2      3.4.1     ✔ tidyr        1.3.0</span></span>
<span><span class="co">## ✔ infer        1.0.4     ✔ tune         1.0.1</span></span>
<span><span class="co">## ✔ modeldata    1.1.0     ✔ workflows    1.1.3</span></span>
<span><span class="co">## ✔ parsnip      1.0.4     ✔ workflowsets 1.0.0</span></span>
<span><span class="co">## ✔ purrr        1.0.1     ✔ yardstick    1.1.0</span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">## ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">## ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">## ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="co">## • Use tidymodels_prefer() to resolve common conflicts.</span></span>
<span><span class="co">## &gt; library(butcher)</span></span>
<span><span class="co">## &gt; library(bestNormalize)</span></span>
<span><span class="co">## &gt; library(sessioninfo)</span></span>
<span><span class="co">## &gt; set.seed(1234)</span></span>
<span><span class="co">## &gt; # Boilerplate options -------------------------------------------------</span></span>
<span><span class="co">## &gt; tidymodels_prefer()</span></span>
<span><span class="co">## &gt; theme_set(theme_bw())</span></span>
<span><span class="co">## &gt; options(pillar.advice = FALSE, pillar.min_title_chars = Inf)</span></span>
<span><span class="co">## &gt; # Setup and partition data --------------------------------------------</span></span>
<span><span class="co">## &gt; data(ames)</span></span>
<span><span class="co">## &gt; ames &lt;-</span></span>
<span><span class="co">## +   ames %&gt;%</span></span>
<span><span class="co">## +   mutate(Sale_Price = log10(Sale_Price)) %&gt;%</span></span>
<span><span class="co">## +   select(-contains("_Cond"))</span></span>
<span><span class="co">## &gt; ames_split &lt;- initial_split(ames, strata = Sale_Price)</span></span>
<span><span class="co">## &gt; ames_not_test &lt;- training(ames_split)</span></span>
<span><span class="co">## &gt; ames_test &lt;- testing(ames_split)</span></span>
<span><span class="co">## &gt; ames_rs &lt;- validation_split(ames_not_test, strata = Sale_Price)</span></span>
<span><span class="co">## &gt; ames_train &lt;- analysis(ames_rs$splits[[1]])</span></span>
<span><span class="co">## &gt; ames_val &lt;- assessment(ames_rs$splits[[1]])</span></span>
<span><span class="co">## &gt; # Flags ---------------------------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; #| description: spline degrees of freedom for longitude</span></span>
<span><span class="co">## &gt; #| min: 2</span></span>
<span><span class="co">## &gt; #| max: 50</span></span>
<span><span class="co">## &gt; longitude_df &lt;- 40L</span></span>
<span><span class="co">## &gt; #| description: spline degrees of freedom for latitude</span></span>
<span><span class="co">## &gt; #| min: 2</span></span>
<span><span class="co">## &gt; #| max: 50</span></span>
<span><span class="co">## &gt; latitude_df &lt;- 40L</span></span>
<span><span class="co">## &gt; #| description: L2 penalty</span></span>
<span><span class="co">## &gt; #| min: 0.0</span></span>
<span><span class="co">## &gt; #| max: 1.0</span></span>
<span><span class="co">## &gt; pen_val &lt;- 0.001</span></span>
<span><span class="co">## &gt; #| description: Mixture of L1 and L2 penalty</span></span>
<span><span class="co">## &gt; #| min: 0.0</span></span>
<span><span class="co">## &gt; #| max: 1.0</span></span>
<span><span class="co">## &gt; mix_val &lt;- 1.0</span></span>
<span><span class="co">## &gt; # Recipe and Workflow -------------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; ames_rec &lt;-</span></span>
<span><span class="co">## +   recipe(Sale_Price ~ ., data = ames_train) %&gt;%</span></span>
<span><span class="co">## +   step_other(MS_SubClass, MS_Zoning, Neighborhood, threshold = 0.05) %&gt;%</span></span>
<span><span class="co">## +   step_orderNorm(Lot_Area, ends_with("_SF"), Gr_Liv_Area) %&gt;%</span></span>
<span><span class="co">## +   step_dummy(all_nominal_predictors()) %&gt;%</span></span>
<span><span class="co">## +   step_interact(~ starts_with("Central"):Year_Built) %&gt;%</span></span>
<span><span class="co">## +   # NOTE We splice the values in via !! so that the step uses their values</span></span>
<span><span class="co">## +   # and not a reference to global variables (a very bad idea)</span></span>
<span><span class="co">## +   step_spline_natural(Longitude, deg_free = !!longitude_df) %&gt;%</span></span>
<span><span class="co">## +   step_spline_natural(Latitude, deg_free = !!latitude_df)</span></span>
<span><span class="co">## &gt; glmn_spec &lt;-</span></span>
<span><span class="co">## +   linear_reg(penalty = pen_val, mixture = mix_val) %&gt;%</span></span>
<span><span class="co">## +   set_engine("glmnet")</span></span>
<span><span class="co">## &gt; ames_wflow &lt;-</span></span>
<span><span class="co">## +   workflow() %&gt;%</span></span>
<span><span class="co">## +   add_model(glmn_spec) %&gt;%</span></span>
<span><span class="co">## +   add_recipe(ames_rec)</span></span>
<span><span class="co">## &gt; ames_fit &lt;- fit(ames_wflow, data = ames_train)</span></span>
<span><span class="co">## &gt; ames_fit</span></span>
<span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 6 Recipe Steps</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## • step_other()</span></span>
<span><span class="co">## • step_orderNorm()</span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "gaussian",      alpha = ~mix_val)</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##      Df  %Dev           Lambda</span></span>
<span><span class="co">## 1     0  0.00 0.12961925523300</span></span>
<span><span class="co">## 2     1  8.70 0.11810423784300</span></span>
<span><span class="co">## 3     2 16.72 0.10761218286200</span></span>
<span><span class="co">## 4     4 25.60 0.09805221312850</span></span>
<span><span class="co">## 5     4 34.44 0.08934152475740</span></span>
<span><span class="co">## 6     5 42.12 0.08140466993350</span></span>
<span><span class="co">## 7     5 48.54 0.07417290341730</span></span>
<span><span class="co">## 8     5 53.88 0.06758358710680</span></span>
<span><span class="co">## 9     5 58.31 0.06157964749640</span></span>
<span><span class="co">## 10    5 61.99 0.05610908133340</span></span>
<span><span class="co">## 11    6 65.07 0.05112450519090</span></span>
<span><span class="co">## 12    6 67.64 0.04658274505480</span></span>
<span><span class="co">## 13    7 69.79 0.04244446237150</span></span>
<span><span class="co">## 14    7 71.82 0.03867381331630</span></span>
<span><span class="co">## 15    8 73.53 0.03523813833070</span></span>
<span><span class="co">## 16    8 75.06 0.03210767924180</span></span>
<span><span class="co">## 17    9 76.41 0.02925532151050</span></span>
<span><span class="co">## 18    9 77.55 0.02665635937850</span></span>
<span><span class="co">## 19    9 78.49 0.02428828187930</span></span>
<span><span class="co">## 20   10 79.28 0.02213057785850</span></span>
<span><span class="co">## 21   12 80.05 0.02016455831600</span></span>
<span><span class="co">## 22   14 80.86 0.01837319453100</span></span>
<span><span class="co">## 23   15 81.61 0.01674097056750</span></span>
<span><span class="co">## 24   17 82.34 0.01525374888240</span></span>
<span><span class="co">## 25   18 83.02 0.01389864787270</span></span>
<span><span class="co">## 26   21 83.64 0.01266393030200</span></span>
<span><span class="co">## 27   21 84.22 0.01153890163720</span></span>
<span><span class="co">## 28   23 84.70 0.01051381741830</span></span>
<span><span class="co">## 29   26 85.14 0.00957979885618</span></span>
<span><span class="co">## 30   29 85.62 0.00872875592883</span></span>
<span><span class="co">## 31   30 86.04 0.00795331730957</span></span>
<span><span class="co">## 32   30 86.39 0.00724676652005</span></span>
<span><span class="co">## 33   35 86.72 0.00660298375533</span></span>
<span><span class="co">## 34   38 87.05 0.00601639287709</span></span>
<span><span class="co">## 35   39 87.35 0.00548191311577</span></span>
<span><span class="co">## 36   42 87.62 0.00499491506335</span></span>
<span><span class="co">## 37   50 87.88 0.00455118057568</span></span>
<span><span class="co">## 38   51 88.15 0.00414686623692</span></span>
<span><span class="co">## 39   54 88.39 0.00377847006967</span></span>
<span><span class="co">## 40   60 88.64 0.00344280120258</span></span>
<span><span class="co">## 41   66 88.88 0.00313695223250</span></span>
<span><span class="co">## 42   69 89.11 0.00285827404197</span></span>
<span><span class="co">## 43   77 89.31 0.00260435285381</span></span>
<span><span class="co">## 44   81 89.51 0.00237298932418</span></span>
<span><span class="co">## 45   85 89.68 0.00216217949285</span></span>
<span><span class="co">## 46   91 89.84 0.00197009742592</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ...</span></span>
<span><span class="co">## and 54 more lines.</span></span>
<span><span class="co">## &gt; # fit -----------------------------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; glmnet_fit &lt;-</span></span>
<span><span class="co">## +   ames_fit %&gt;%</span></span>
<span><span class="co">## +   extract_fit_engine()</span></span>
<span><span class="co">## &gt; glmnet_pred &lt;-</span></span>
<span><span class="co">## +   glmnet_fit %&gt;%</span></span>
<span><span class="co">## +   coef(s = pen_val) %&gt;%</span></span>
<span><span class="co">## +   apply(2, function(x) sum(x != 0))</span></span>
<span><span class="co">## &gt; glmnet_fit %&gt;% autoplot(best_penalty = pen_val)</span></span>
<span><span class="co">## &gt; # Validation set results ----------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; ames_pred &lt;- augment(ames_fit, ames_val)</span></span>
<span><span class="co">## &gt; ames_pred %&gt;%</span></span>
<span><span class="co">## +   ggplot(aes(Sale_Price, .pred)) +</span></span>
<span><span class="co">## +   geom_abline(col = "green", lty = 2) +</span></span>
<span><span class="co">## +   geom_point(alpha = 1 / 3) +</span></span>
<span><span class="co">## +   coord_obs_pred() +</span></span>
<span><span class="co">## +   labs(x = "Observed (log-10)", y = "Predicted (log-10)")</span></span>
<span><span class="co">## &gt; val_results &lt;- ames_pred %&gt;% metrics(Sale_Price, .pred)</span></span>
<span><span class="co">## &gt; cat('validation_rmse:', val_results$.estimate[1], "\n")</span></span>
<span><span class="co">## validation_rmse: 0.0548724422689783</span></span>
<span><span class="co">## &gt; cat('validation_R2:', val_results$.estimate[2], "\n")</span></span>
<span><span class="co">## validation_R2: 0.894286076866259</span></span>
<span><span class="co">## &gt; cat('num_predictors:', glmnet_pred, "\n")</span></span>
<span><span class="co">## num_predictors: 138</span></span>
<span><span class="co">## &gt; # Save object ---------------------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; # butcher the objects to make their install sizes smaller</span></span>
<span><span class="co">## &gt; ames_fit &lt;- butcher(ames_fit)</span></span>
<span><span class="co">## &gt; # Save objects in the current working directory</span></span>
<span><span class="co">## &gt; save(ames_fit, val_results, file = ".RData",</span></span>
<span><span class="co">## +      compress = TRUE)</span></span>
<span><span class="co">## &gt; # ---------------------------------------------------------------------</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## &gt; session_info()</span></span>
<span><span class="co">## ─ Session info ───────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  setting  value</span></span>
<span><span class="co">##  version  R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">##  os       Ubuntu 20.04.5 LTS</span></span>
<span><span class="co">##  system   x86_64, linux-gnu</span></span>
<span><span class="co">##  ui       X11</span></span>
<span><span class="co">##  language (EN)</span></span>
<span><span class="co">##  collate  en_US.UTF-8</span></span>
<span><span class="co">##  ctype    en_US.UTF-8</span></span>
<span><span class="co">##  tz       America/New_York</span></span>
<span><span class="co">##  date     2023-03-01</span></span>
<span><span class="co">##  pandoc   2.5 @ /usr/bin/pandoc</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ─ Packages ───────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  package       * version    date (UTC) lib source</span></span>
<span><span class="co">##  backports       1.4.1      2021-12-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  bestNormalize * 1.8.3      2022-06-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  broom         * 1.0.3      2023-01-25 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  butcher       * 0.3.1      2022-12-14 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  cachem          1.0.7      2023-02-24 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  class           7.3-21     2023-01-23 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  cli             3.6.0      2023-01-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  codetools       0.2-19     2023-02-01 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  colorspace      2.1-0      2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  conflicted      1.2.0      2023-02-01 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  dials         * 1.1.0      2022-11-04 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  DiceDesign      1.9        2021-02-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  digest          0.6.31     2022-12-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  doParallel      1.0.17     2022-02-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  doRNG           1.8.6      2023-01-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  dplyr         * 1.1.0      2023-01-29 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ellipsis        0.3.2      2021-04-29 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  fansi           1.0.4      2023-01-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  farver          2.1.1      2022-07-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  fastmap         1.1.1      2023-02-24 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  foreach         1.5.2      2022-02-02 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  furrr           0.3.1      2022-08-15 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  future          1.31.0     2023-02-01 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  future.apply    1.10.0     2022-11-05 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  generics        0.1.3      2022-07-05 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ggplot2       * 3.4.1      2023-02-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ggrepel         0.9.3      2023-02-03 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  glmnet          4.1-6      2022-11-27 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  globals         0.16.2     2022-11-21 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  glue            1.6.2      2022-02-24 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  gower           1.0.1      2022-12-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  GPfit           1.0-8      2019-02-08 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  gtable          0.3.1      2022-09-01 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  guildai         0.0.0.9001 2023-02-28 [1] Github (guildai/guildai-r@a6c0059)</span></span>
<span><span class="co">##  hardhat         1.2.0      2022-06-30 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  infer         * 1.0.4      2022-12-02 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ipred           0.9-13     2022-06-02 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  iterators       1.0.14     2022-02-05 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  jsonlite        1.8.4      2022-12-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  labeling        0.4.2      2020-10-20 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lattice         0.20-45    2021-09-22 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lava            1.7.2.1    2023-02-27 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lhs             1.1.6      2022-12-17 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lifecycle       1.0.3      2022-10-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  listenv         0.9.0      2022-12-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lubridate       1.9.2      2023-02-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  magrittr        2.0.3      2022-03-30 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  MASS            7.3-58.2   2023-01-23 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  Matrix          1.5-3      2022-11-11 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  memoise         2.0.1      2021-11-26 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  modeldata     * 1.1.0      2023-01-25 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  munsell         0.5.0      2018-06-12 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  nnet            7.3-18     2022-09-28 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  nortest         1.0-4      2015-07-30 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  parallelly      1.34.0     2023-01-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  parsnip       * 1.0.4      2023-02-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  pillar          1.8.1      2022-08-19 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  pkgconfig       2.0.3      2019-09-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  prodlim         2019.11.13 2019-11-17 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  purrr         * 1.0.1      2023-01-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  R6              2.5.1      2021-08-19 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  Rcpp            1.0.10     2023-01-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  recipes       * 1.0.5      2023-02-20 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rlang           1.0.6      2022-09-24 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rngtools        1.5.2      2021-09-20 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rpart           4.1.19     2022-10-21 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rsample       * 1.1.1      2022-12-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rstudioapi      0.14       2022-08-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  scales        * 1.2.1      2022-08-20 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  sessioninfo   * 1.2.2      2021-12-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  shape           1.4.6      2021-05-19 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  splines2        0.4.7      2023-01-14 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  survival        3.5-3      2023-02-12 [2] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tibble        * 3.1.8      2022-07-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tidymodels    * 1.0.0      2022-07-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tidyr         * 1.3.0      2023-01-24 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tidyselect      1.2.0      2022-10-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  timechange      0.2.0      2023-01-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  timeDate        4022.108   2023-01-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tune          * 1.0.1      2022-10-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  utf8            1.2.3      2023-01-31 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  vctrs           0.5.2      2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  withr           2.5.0      2022-03-03 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  workflows     * 1.1.3      2023-02-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  workflowsets  * 1.0.0      2022-07-12 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  yaml            2.3.7      2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  yardstick     * 1.1.0      2022-09-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##  [1] /home/tomasz/opt/R-4.2.2/lib/R/site-library</span></span>
<span><span class="co">##  [2] /home/tomasz/opt/R-4.2.2/lib/R/library</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ──────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/guild_view.html">guild_view</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can use the flags and flag constraints to run an optimizer. We
could use one of the guildai built-in optimizers, or manually define a
grid using tidymodels functions, like this:</p>
<div class="cell" paged.print="false">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use existing tidymodels code to generate a space-filling design for</span></span>
<span><span class="co"># new hyperparameter combinations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">## ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</span></span>
<span><span class="co">## ✔ broom        1.0.3     ✔ recipes      1.0.5</span></span>
<span><span class="co">## ✔ dials        1.1.0     ✔ rsample      1.1.1</span></span>
<span><span class="co">## ✔ dplyr        1.1.0     ✔ tibble       3.1.8</span></span>
<span><span class="co">## ✔ ggplot2      3.4.1     ✔ tidyr        1.3.0</span></span>
<span><span class="co">## ✔ infer        1.0.4     ✔ tune         1.0.1</span></span>
<span><span class="co">## ✔ modeldata    1.1.0     ✔ workflows    1.1.3</span></span>
<span><span class="co">## ✔ parsnip      1.0.4     ✔ workflowsets 1.0.0</span></span>
<span><span class="co">## ✔ purrr        1.0.1     ✔ yardstick    1.1.0</span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">## ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">## ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">## ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="co">## • Dig deeper into tidy modeling with R at https://www.tmwr.org</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">parameters</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pen_val <span class="op">=</span> <span class="fu">penalty</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  mix_val <span class="op">=</span> <span class="fu">mixture</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  latitude_df <span class="op">=</span> <span class="fu">spline_degree</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">50L</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  longitude_df <span class="op">=</span> <span class="fu">spline_degree</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">50L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu">grid_latin_hypercube</span><span class="op">(</span><span class="va">params</span>, size <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="va">grid</span></span>
<span><span class="co">## # A tibble: 19 × 4</span></span>
<span><span class="co">##     pen_val mix_val latitude_df longitude_df</span></span>
<span><span class="co">##       &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  1 1.10e- 8  0.915           21           31</span></span>
<span><span class="co">##  2 3.88e- 3  0.289           29            2</span></span>
<span><span class="co">##  3 1.11e- 7  0.996           25            5</span></span>
<span><span class="co">##  4 1.57e- 4  0.480           37           26</span></span>
<span><span class="co">##  5 1.00e- 3  0.568           47           29</span></span>
<span><span class="co">##  6 3.10e- 9  0.0644           4           12</span></span>
<span><span class="co">##  7 2.54e-10  0.841            6           37</span></span>
<span><span class="co">##  8 1.13e- 1  0.401           50           44</span></span>
<span><span class="co">##  9 6.15e- 7  0.633           15           38</span></span>
<span><span class="co">## 10 1.81e- 5  0.254           41           49</span></span>
<span><span class="co">## 11 5.81e- 5  0.363           32            7</span></span>
<span><span class="co">## 12 6.53e- 1  0.0346          19           24</span></span>
<span><span class="co">## 13 4.48e- 4  0.879           38           42</span></span>
<span><span class="co">## 14 4.15e- 2  0.613           14           13</span></span>
<span><span class="co">## 15 1.06e- 9  0.457           11           35</span></span>
<span><span class="co">## 16 1.83e- 2  0.777            8           21</span></span>
<span><span class="co">## 17 2.96e- 6  0.174           42           46</span></span>
<span><span class="co">## 18 2.81e- 8  0.690           34           16</span></span>
<span><span class="co">## 19 3.40e- 7  0.157           26           20</span></span>
<span></span>
<span><span class="co"># Launch a batch of run defined by the grid flags.</span></span>
<span><span class="fu"><a href="../../reference/guild_run.html">guild_run</a></span><span class="op">(</span></span>
<span>  <span class="st">"train-tidymodels.R"</span>,</span>
<span>  flags <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  echo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># ignore stdout *and* stderr</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Find the best run:</p>
<div class="cell" paged.print="false">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runs_info.html">runs_info</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"train-tidymodels.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runs</span><span class="op">$</span><span class="va">scalars</span></span>
<span><span class="co">## # A tibble: 20 × 3</span></span>
<span><span class="co">##    num_predictors validation_R2 validation_rmse</span></span>
<span><span class="co">##             &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">##  1            206         0.887          0.0571</span></span>
<span><span class="co">##  2            206         0.871          0.0614</span></span>
<span><span class="co">##  3            206         0.886          0.0573</span></span>
<span><span class="co">##  4             19         0.857          0.0671</span></span>
<span><span class="co">##  5            206         0.878          0.0597</span></span>
<span><span class="co">##  6             12         0.845          0.0759</span></span>
<span><span class="co">##  7            172         0.892          0.0556</span></span>
<span><span class="co">##  8             50         0.854          0.0963</span></span>
<span><span class="co">##  9            204         0.884          0.0579</span></span>
<span><span class="co">## 10            206         0.884          0.0581</span></span>
<span><span class="co">## 11            206         0.873          0.0610</span></span>
<span><span class="co">## 12             11         0.837          0.0971</span></span>
<span><span class="co">## 13            206         0.868          0.0624</span></span>
<span><span class="co">## 14            206         0.892          0.0558</span></span>
<span><span class="co">## 15            158         0.894          0.0551</span></span>
<span><span class="co">## 16            197         0.892          0.0558</span></span>
<span><span class="co">## 17            206         0.864          0.0634</span></span>
<span><span class="co">## 18            132         0.895          0.0546</span></span>
<span><span class="co">## 19            206         0.866          0.0628</span></span>
<span><span class="co">## 20            138         0.894          0.0549</span></span></code></pre></div>
</div>
<div class="cell" paged.print="false">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_run</span> <span class="op">&lt;-</span> <span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span><span class="va">scalars</span><span class="op">$</span><span class="va">validation_rmse</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Recover the fitted model and validation from the best run:</p>
<div class="cell" paged.print="false">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_run_saved_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">best_run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".RData"</span><span class="op">)</span>,</span>
<span>     envir <span class="op">=</span> <span class="va">best_run_saved_objects</span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_run_saved_objects</span><span class="op">$</span><span class="va">ames_fit</span></span>
<span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 6 Recipe Steps</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## • step_other()</span></span>
<span><span class="co">## • step_orderNorm()</span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Call:  dummy_call()</span></span>
<span><span class="co">##</span></span>
<span><span class="co">##      Df  %Dev  Lambda</span></span>
<span><span class="co">## 1     0  0.00 0.44850</span></span>
<span><span class="co">## 2     2  3.53 0.40860</span></span>
<span><span class="co">## 3     4  9.53 0.37230</span></span>
<span><span class="co">## 4     6 17.29 0.33920</span></span>
<span><span class="co">## 5     7 25.01 0.30910</span></span>
<span><span class="co">## 6     7 32.02 0.28160</span></span>
<span><span class="co">## 7     7 38.24 0.25660</span></span>
<span><span class="co">## 8     9 43.79 0.23380</span></span>
<span><span class="co">## 9    10 48.82 0.21310</span></span>
<span><span class="co">## 10   10 53.42 0.19410</span></span>
<span><span class="co">## 11   10 57.41 0.17690</span></span>
<span><span class="co">## 12   11 60.91 0.16120</span></span>
<span><span class="co">## 13   12 64.09 0.14690</span></span>
<span><span class="co">## 14   12 66.86 0.13380</span></span>
<span><span class="co">## 15   14 69.28 0.12190</span></span>
<span><span class="co">## 16   14 71.37 0.11110</span></span>
<span><span class="co">## 17   15 73.20 0.10120</span></span>
<span><span class="co">## 18   16 74.79 0.09223</span></span>
<span><span class="co">## 19   17 76.20 0.08403</span></span>
<span><span class="co">## 20   18 77.44 0.07657</span></span>
<span><span class="co">## 21   20 78.62 0.06977</span></span>
<span><span class="co">## 22   24 79.68 0.06357</span></span>
<span><span class="co">## 23   25 80.61 0.05792</span></span>
<span><span class="co">## 24   25 81.46 0.05278</span></span>
<span><span class="co">## 25   28 82.31 0.04809</span></span>
<span><span class="co">## 26   31 83.08 0.04382</span></span>
<span><span class="co">## 27   33 83.76 0.03992</span></span>
<span><span class="co">## 28   35 84.35 0.03638</span></span>
<span><span class="co">## 29   38 84.89 0.03314</span></span>
<span><span class="co">## 30   39 85.40 0.03020</span></span>
<span><span class="co">## 31   39 85.87 0.02752</span></span>
<span><span class="co">## 32   41 86.28 0.02507</span></span>
<span><span class="co">## 33   45 86.67 0.02285</span></span>
<span><span class="co">## 34   48 87.03 0.02082</span></span>
<span><span class="co">## 35   50 87.37 0.01897</span></span>
<span><span class="co">## 36   53 87.68 0.01728</span></span>
<span><span class="co">## 37   55 87.96 0.01575</span></span>
<span><span class="co">## 38   58 88.21 0.01435</span></span>
<span><span class="co">## 39   61 88.44 0.01307</span></span>
<span><span class="co">## 40   65 88.66 0.01191</span></span>
<span><span class="co">## 41   71 88.88 0.01085</span></span>
<span><span class="co">## 42   76 89.10 0.00989</span></span>
<span><span class="co">## 43   80 89.30 0.00901</span></span>
<span><span class="co">## 44   85 89.49 0.00821</span></span>
<span><span class="co">## 45   93 89.66 0.00748</span></span>
<span><span class="co">## 46   94 89.82 0.00682</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## ...</span></span>
<span><span class="co">## and 54 more lines.</span></span>
<span></span>
<span><span class="va">best_run_saved_objects</span><span class="op">$</span><span class="va">val_results</span></span>
<span><span class="co">## # A tibble: 3 × 3</span></span>
<span><span class="co">##   .metric .estimator .estimate</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">## 1 rmse    standard      0.0546</span></span>
<span><span class="co">## 2 rsq     standard      0.895</span></span>
<span><span class="co">## 3 mae     standard      0.0395</span></span></code></pre></div>
</div>
<p>For reproducibility, (or preparing to deploy a model) it can be
helpful to know some additional run metadata, like the starting random
seed or a log of which R packages were loaded during the R session. This
information is all stored under the <code>RUN_DIR/.guild</code>
directory.</p>
<p>To recover the seed:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="va">best_run</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".guild/attrs/random_seed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seed</span></span>
<span><span class="co">## [1] 400252956</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="co"># restore the starting seed.</span></span></code></pre></div>
</div>
<p>To access the log of R loaded packages:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">packages_loaded</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".guild/attrs/r_packages_loaded"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">packages_loaded</span>, list.len <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## List of 98</span></span>
<span><span class="co">##  $ guildai      :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/opt/R-4.2.2/lib/R/site-library/guildai"</span></span>
<span><span class="co">##   ..$ version: chr "0.0.0.9001"</span></span>
<span><span class="co">##  $ grDevices    :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/opt/R-4.2.2/lib/R/library/grDevices"</span></span>
<span><span class="co">##   ..$ version: chr "4.2.2"</span></span>
<span><span class="co">##  $ fansi        :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/opt/R-4.2.2/lib/R/site-library/fansi"</span></span>
<span><span class="co">##   ..$ version: chr "1.0.4"</span></span>
<span><span class="co">##  $ utf8         :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/opt/R-4.2.2/lib/R/site-library/utf8"</span></span>
<span><span class="co">##   ..$ version: chr "1.2.3"</span></span>
<span><span class="co">##  $ dplyr        :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/opt/R-4.2.2/lib/R/site-library/dplyr"</span></span>
<span><span class="co">##   ..$ version: chr "1.1.0"</span></span>
<span><span class="co">##   [list output truncated]</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomasz Kalinowski, Posit, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
