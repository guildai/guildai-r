<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="guildai">
<title> • guildai</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="guildai">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">guildai</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../articles/guildai.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../../articles/examples/keras.html">keras</a>
    <a class="dropdown-item" href="../../articles/examples/xgboost.html">xgboost</a>
    <a class="dropdown-item" href="../../articles/examples/tidymodels.html">tidymodels</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/t-kalinowski/guildai-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/t-kalinowski/guildai-r/blob/HEAD/vignettes/examples/tidymodels.Rmd" class="external-link"><code>vignettes/examples/tidymodels.Rmd</code></a></small>
      <div class="d-none name"><code>tidymodels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="example_tidymodels">example_tidymodels<a class="anchor" aria-label="anchor" href="#example_tidymodels"></a>
</h2>
<p>Here is an example showing how to use <em>guildai</em> with
tidymodels in R.</p>
<p>If this is your first exposure to <em>guildai</em>, we recommend
starting with the framework agnostic “Getting Started” guide. This
example assumes familiarity with guild concepts like <em>flags</em> and
<em>scalars</em>.</p>
<p>We’ll start with an example R script, named “train-tidymodels.R”,
that trains, evaluates, and saves an tidymodels model using the “Ames
Housing” dataset. Here is what it looks like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://butcher.tidymodels.org/" class="external-link">butcher</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/" class="external-link">bestNormalize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/sessioninfo#readme" class="external-link">sessioninfo</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Boilerplate options -------------------------------------------------</span></span>
<span><span class="fu">tidymodels_prefer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>pillar.advice <span class="op">=</span> <span class="cn">FALSE</span>, pillar.min_title_chars <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Setup and partition data --------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"_Cond"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_not_test</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_rs</span> <span class="op">&lt;-</span> <span class="fu">validation_split</span><span class="op">(</span><span class="va">ames_not_test</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">analysis</span><span class="op">(</span><span class="va">ames_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ames_val</span> <span class="op">&lt;-</span> <span class="fu">assessment</span><span class="op">(</span><span class="va">ames_rs</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flags ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">#| description: spline degrees of freedom for longitude</span></span>
<span><span class="co">#| min: 2</span></span>
<span><span class="co">#| max: 50</span></span>
<span><span class="va">longitude_df</span> <span class="op">&lt;-</span> <span class="fl">40L</span></span>
<span></span>
<span><span class="co">#| description: spline degrees of freedom for latitude</span></span>
<span><span class="co">#| min: 2</span></span>
<span><span class="co">#| max: 50</span></span>
<span><span class="va">latitude_df</span> <span class="op">&lt;-</span> <span class="fl">40L</span></span>
<span></span>
<span><span class="co">#| description: L2 penalty</span></span>
<span><span class="co">#| min: 0.0</span></span>
<span><span class="co">#| max: 1.0</span></span>
<span><span class="va">pen_val</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span></span>
<span><span class="co">#| description: Mixture of L1 and L2 penalty</span></span>
<span><span class="co">#| min: 0.0</span></span>
<span><span class="co">#| max: 1.0</span></span>
<span><span class="va">mix_val</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span></span>
<span><span class="co"># Recipe and Workflow -------------------------------------------------</span></span>
<span></span>
<span><span class="va">ames_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="va">MS_SubClass</span>, <span class="va">MS_Zoning</span>, <span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_orderNorm</span><span class="op">(</span><span class="va">Lot_Area</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_SF"</span><span class="op">)</span>, <span class="va">Gr_Liv_Area</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Central"</span><span class="op">)</span><span class="op">:</span><span class="va">Year_Built</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># NOTE We splice the values in via !! so that the step uses their values</span></span>
<span>  <span class="co"># and not a reference to global variables (a very bad idea)</span></span>
<span>  <span class="fu">step_spline_natural</span><span class="op">(</span><span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">longitude_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_spline_natural</span><span class="op">(</span><span class="va">Latitude</span>, deg_free <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">latitude_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmn_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">pen_val</span>, mixture <span class="op">=</span> <span class="va">mix_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">glmn_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">ames_wflow</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span>
<span><span class="va">ames_fit</span></span>
<span></span>
<span><span class="co"># fit -----------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">glmnet_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_pred</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glmnet_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">pen_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glmnet_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">autoplot</span><span class="op">(</span>best_penalty <span class="op">=</span> <span class="va">pen_val</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Validation set results ----------------------------------------------</span></span>
<span></span>
<span><span class="va">ames_pred</span> <span class="op">&lt;-</span> <span class="fu">augment</span><span class="op">(</span><span class="va">ames_fit</span>, <span class="va">ames_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"green"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_obs_pred</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Observed (log-10)"</span>, y <span class="op">=</span> <span class="st">"Predicted (log-10)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">val_results</span> <span class="op">&lt;-</span> <span class="va">ames_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">metrics</span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'validation_rmse:'</span>, <span class="va">val_results</span><span class="op">$</span><span class="va">.estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'validation_R2:'</span>, <span class="va">val_results</span><span class="op">$</span><span class="va">.estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'num_predictors:'</span>, <span class="va">glmnet_pred</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save object ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># butcher the objects to make their install sizes smaller</span></span>
<span><span class="va">ames_fit</span> <span class="op">&lt;-</span> <span class="fu">butcher</span><span class="op">(</span><span class="va">ames_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save objects in the current working directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">ames_fit</span>, <span class="va">val_results</span>, file <span class="op">=</span> <span class="st">".RData"</span>,</span>
<span>     compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>A few things to note about the script:</p>
<ul>
<li>There is no ‘guildai’ specific configuration in the script code.
It’s a regular R script, that you can safely <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> or
work with interactively at the REPL.</li>
<li>We declare some constraints on the flag values we’ve defined.</li>
<li>At the end of the run, we save the model. This file artifacts will
be stored as part of the run, enabling us to restore a trained
model.</li>
</ul>
<p>With our script defined, we can launch a guild run and view it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://t-kalinowski.github.io/guildai-r/">guildai</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/guild_run.html">guild_run</a></span><span class="op">(</span><span class="st">"train-tidymodels.R"</span><span class="op">)</span></span>
<span><span class="co">## &gt; library(tidymodels)</span></span>
<span><span class="co">## ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</span></span>
<span><span class="co">## ✔ broom        1.0.2      ✔ recipes      1.0.4 </span></span>
<span><span class="co">## ✔ dials        1.1.0      ✔ rsample      1.1.1 </span></span>
<span><span class="co">## ✔ dplyr        1.0.10     ✔ tibble       3.1.8 </span></span>
<span><span class="co">## ✔ ggplot2      3.4.0      ✔ tidyr        1.2.1 </span></span>
<span><span class="co">## ✔ infer        1.0.4      ✔ tune         1.0.1 </span></span>
<span><span class="co">## ✔ modeldata    1.0.1      ✔ workflows    1.1.2 </span></span>
<span><span class="co">## ✔ parsnip      1.0.3      ✔ workflowsets 1.0.0 </span></span>
<span><span class="co">## ✔ purrr        1.0.1      ✔ yardstick    1.1.0 </span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">## ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">## ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">## ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="co">## • Search for functions across packages at https://www.tidymodels.org/find/</span></span>
<span><span class="co">## &gt; library(butcher)</span></span>
<span><span class="co">## &gt; library(bestNormalize)</span></span>
<span><span class="co">## &gt; library(sessioninfo)</span></span>
<span><span class="co">## &gt; # Boilerplate options -------------------------------------------------</span></span>
<span><span class="co">## &gt; tidymodels_prefer()</span></span>
<span><span class="co">## &gt; theme_set(theme_bw())</span></span>
<span><span class="co">## &gt; options(pillar.advice = FALSE, pillar.min_title_chars = Inf)</span></span>
<span><span class="co">## &gt; # Setup and partition data --------------------------------------------</span></span>
<span><span class="co">## &gt; data(ames)</span></span>
<span><span class="co">## &gt; ames &lt;-</span></span>
<span><span class="co">## +   ames %&gt;%</span></span>
<span><span class="co">## +   mutate(Sale_Price = log10(Sale_Price)) %&gt;%</span></span>
<span><span class="co">## +   select(-contains("_Cond"))</span></span>
<span><span class="co">## &gt; ames_split &lt;- initial_split(ames, strata = Sale_Price)</span></span>
<span><span class="co">## &gt; ames_not_test &lt;- training(ames_split)</span></span>
<span><span class="co">## &gt; ames_test &lt;- testing(ames_split)</span></span>
<span><span class="co">## &gt; ames_rs &lt;- validation_split(ames_not_test, strata = Sale_Price)</span></span>
<span><span class="co">## &gt; ames_train &lt;- analysis(ames_rs$splits[[1]])</span></span>
<span><span class="co">## &gt; ames_val &lt;- assessment(ames_rs$splits[[1]])</span></span>
<span><span class="co">## &gt; # Flags ---------------------------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; #| description: spline degrees of freedom for longitude</span></span>
<span><span class="co">## &gt; #| min: 2</span></span>
<span><span class="co">## &gt; #| max: 50</span></span>
<span><span class="co">## &gt; longitude_df &lt;- 40L</span></span>
<span><span class="co">## &gt; #| description: spline degrees of freedom for latitude</span></span>
<span><span class="co">## &gt; #| min: 2</span></span>
<span><span class="co">## &gt; #| max: 50</span></span>
<span><span class="co">## &gt; latitude_df &lt;- 40L</span></span>
<span><span class="co">## &gt; #| description: L2 penalty</span></span>
<span><span class="co">## &gt; #| min: 0.0</span></span>
<span><span class="co">## &gt; #| max: 1.0</span></span>
<span><span class="co">## &gt; pen_val &lt;- 0.001</span></span>
<span><span class="co">## &gt; #| description: Mixture of L1 and L2 penalty</span></span>
<span><span class="co">## &gt; #| min: 0.0</span></span>
<span><span class="co">## &gt; #| max: 1.0</span></span>
<span><span class="co">## &gt; mix_val &lt;- 1.0</span></span>
<span><span class="co">## &gt; # Recipe and Workflow -------------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; ames_rec &lt;-</span></span>
<span><span class="co">## +   recipe(Sale_Price ~ ., data = ames_train) %&gt;%</span></span>
<span><span class="co">## +   step_other(MS_SubClass, MS_Zoning, Neighborhood, threshold = 0.05) %&gt;%</span></span>
<span><span class="co">## +   step_orderNorm(Lot_Area, ends_with("_SF"), Gr_Liv_Area) %&gt;%</span></span>
<span><span class="co">## +   step_dummy(all_nominal_predictors()) %&gt;%</span></span>
<span><span class="co">## +   step_interact(~ starts_with("Central"):Year_Built) %&gt;%</span></span>
<span><span class="co">## +   # NOTE We splice the values in via !! so that the step uses their values</span></span>
<span><span class="co">## +   # and not a reference to global variables (a very bad idea)</span></span>
<span><span class="co">## +   step_spline_natural(Longitude, deg_free = !!longitude_df) %&gt;%</span></span>
<span><span class="co">## +   step_spline_natural(Latitude, deg_free = !!latitude_df)</span></span>
<span><span class="co">## &gt; glmn_spec &lt;-</span></span>
<span><span class="co">## +   linear_reg(penalty = pen_val, mixture = mix_val) %&gt;%</span></span>
<span><span class="co">## +   set_engine("glmnet")</span></span>
<span><span class="co">## &gt; ames_wflow &lt;-</span></span>
<span><span class="co">## +   workflow() %&gt;%</span></span>
<span><span class="co">## +   add_model(glmn_spec) %&gt;%</span></span>
<span><span class="co">## +   add_recipe(ames_rec)</span></span>
<span><span class="co">## &gt; ames_fit &lt;- fit(ames_wflow, data = ames_train)</span></span>
<span><span class="co">## &gt; ames_fit</span></span>
<span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 6 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## • step_other()</span></span>
<span><span class="co">## • step_orderNorm()</span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "gaussian",      alpha = ~mix_val) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Df  %Dev           Lambda</span></span>
<span><span class="co">## 1    0  0.00 0.12676844223500</span></span>
<span><span class="co">## 2    1  9.17 0.11550668321600</span></span>
<span><span class="co">## 3    2 17.31 0.10524538782900</span></span>
<span><span class="co">## 4    3 26.20 0.09589567764230</span></span>
<span><span class="co">## 5    4 35.13 0.08737656994010</span></span>
<span><span class="co">## 6    4 42.80 0.07961427628660</span></span>
<span><span class="co">## 7    4 49.16 0.07254156340740</span></span>
<span><span class="co">## 8    4 54.44 0.06609717084720</span></span>
<span><span class="co">## 9    5 58.90 0.06022528036060</span></span>
<span><span class="co">## 10   5 62.81 0.05487503244120</span></span>
<span><span class="co">## 11   5 66.04 0.05000008580100</span></span>
<span><span class="co">## 12   5 68.73 0.04555821598450</span></span>
<span><span class="co">## 13   6 70.98 0.04151094964010</span></span>
<span><span class="co">## 14   6 72.84 0.03782323128310</span></span>
<span><span class="co">## 15   7 74.59 0.03446311966110</span></span>
<span><span class="co">## 16   7 76.09 0.03140151109470</span></span>
<span><span class="co">## 17   8 77.34 0.02861188739530</span></span>
<span><span class="co">## 18   8 78.43 0.02607008617670</span></span>
<span><span class="co">## 19   8 79.34 0.02375409157300</span></span>
<span><span class="co">## 20   9 80.11 0.02164384354660</span></span>
<span><span class="co">## 21  12 80.88 0.01972106413890</span></span>
<span><span class="co">## 22  14 81.75 0.01796909915430</span></span>
<span><span class="co">## 23  14 82.51 0.01637277391040</span></span>
<span><span class="co">## 24  15 83.15 0.01491826180140</span></span>
<span><span class="co">## 25  15 83.74 0.01359296453940</span></span>
<span><span class="co">## 26  20 84.33 0.01238540303350</span></span>
<span><span class="co">## 27  22 84.90 0.01128511796360</span></span>
<span><span class="co">## 28  26 85.42 0.01028257918680</span></span>
<span><span class="co">## 29  28 86.02 0.00936910319185</span></span>
<span><span class="co">## 30  28 86.54 0.00853677788662</span></span>
<span><span class="co">## 31  31 86.99 0.00777839406752</span></span>
<span><span class="co">## 32  33 87.41 0.00708738297671</span></span>
<span><span class="co">## 33  33 87.77 0.00645775940670</span></span>
<span><span class="co">## 34  37 88.10 0.00588406985934</span></span>
<span><span class="co">## 35  41 88.45 0.00536134531022</span></span>
<span><span class="co">## 36  44 88.79 0.00488505816934</span></span>
<span><span class="co">## 37  47 89.11 0.00445108306536</span></span>
<span><span class="co">## 38  49 89.39 0.00405566111354</span></span>
<span><span class="co">## 39  52 89.64 0.00369536735808</span></span>
<span><span class="co">## 40  55 89.87 0.00336708110685</span></span>
<span><span class="co">## 41  56 90.07 0.00306795890138</span></span>
<span><span class="co">## 42  60 90.25 0.00279540988823</span></span>
<span><span class="co">## 43  69 90.44 0.00254707337823</span></span>
<span><span class="co">## 44  70 90.62 0.00232079839934</span></span>
<span><span class="co">## 45  71 90.78 0.00211462506593</span></span>
<span><span class="co">## 46  74 90.91 0.00192676760322</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ...</span></span>
<span><span class="co">## and 45 more lines.</span></span>
<span><span class="co">## &gt; # fit -----------------------------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; glmnet_fit &lt;-</span></span>
<span><span class="co">## +   ames_fit %&gt;%</span></span>
<span><span class="co">## +   extract_fit_engine()</span></span>
<span><span class="co">## &gt; glmnet_pred &lt;-</span></span>
<span><span class="co">## +   glmnet_fit %&gt;%</span></span>
<span><span class="co">## +   coef(s = pen_val) %&gt;%</span></span>
<span><span class="co">## +   apply(2, function(x) sum(x != 0))</span></span>
<span><span class="co">## &gt; glmnet_fit %&gt;% autoplot(best_penalty = pen_val)</span></span>
<span><span class="co">## &gt; # Validation set results ----------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; ames_pred &lt;- augment(ames_fit, ames_val)</span></span>
<span><span class="co">## &gt; ames_pred %&gt;%</span></span>
<span><span class="co">## +   ggplot(aes(Sale_Price, .pred)) +</span></span>
<span><span class="co">## +   geom_abline(col = "green", lty = 2) +</span></span>
<span><span class="co">## +   geom_point(alpha = 1 / 3) +</span></span>
<span><span class="co">## +   coord_obs_pred() +</span></span>
<span><span class="co">## +   labs(x = "Observed (log-10)", y = "Predicted (log-10)")</span></span>
<span><span class="co">## &gt; val_results &lt;- ames_pred %&gt;% metrics(Sale_Price, .pred)</span></span>
<span><span class="co">## &gt; cat('validation_rmse:', val_results$.estimate[1], "\n")</span></span>
<span><span class="co">## validation_rmse: 0.0754700452208367 </span></span>
<span><span class="co">## &gt; cat('validation_R2:', val_results$.estimate[2], "\n")</span></span>
<span><span class="co">## validation_R2: 0.828298950423991 </span></span>
<span><span class="co">## &gt; cat('num_predictors:', glmnet_pred, "\n")</span></span>
<span><span class="co">## num_predictors: 129 </span></span>
<span><span class="co">## &gt; # Save object ---------------------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; # butcher the objects to make their install sizes smaller</span></span>
<span><span class="co">## &gt; ames_fit &lt;- butcher(ames_fit)</span></span>
<span><span class="co">## &gt; # Save objects in the current working directory</span></span>
<span><span class="co">## &gt; save(ames_fit, val_results, file = ".RData",</span></span>
<span><span class="co">## +      compress = TRUE)</span></span>
<span><span class="co">## &gt; # ---------------------------------------------------------------------</span></span>
<span><span class="co">## &gt; </span></span>
<span><span class="co">## &gt; session_info()</span></span>
<span><span class="co">## ─ Session info ───────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  setting  value</span></span>
<span><span class="co">##  version  R version 4.2.2 Patched (2022-11-10 r83330)</span></span>
<span><span class="co">##  os       Ubuntu 20.04.5 LTS</span></span>
<span><span class="co">##  system   x86_64, linux-gnu</span></span>
<span><span class="co">##  ui       X11</span></span>
<span><span class="co">##  language (EN)</span></span>
<span><span class="co">##  collate  en_US.UTF-8</span></span>
<span><span class="co">##  ctype    en_US.UTF-8</span></span>
<span><span class="co">##  tz       America/New_York</span></span>
<span><span class="co">##  date     2023-01-23</span></span>
<span><span class="co">##  pandoc   2.5 @ /usr/bin/pandoc</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ─ Packages ───────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##  package       * version    date (UTC) lib source</span></span>
<span><span class="co">##  assertthat      0.2.1      2019-03-21 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  backports       1.4.1      2021-12-13 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  bestNormalize * 1.8.3      2022-06-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  broom         * 1.0.2      2022-12-15 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  butcher       * 0.3.1      2022-12-14 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  cachem          1.0.6      2021-08-19 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  class           7.3-21     2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  cli             3.6.0      2023-01-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  codetools       0.2-18     2020-11-04 [4] CRAN (R 4.0.3)</span></span>
<span><span class="co">##  colorspace      2.1-0      2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  conflicted      1.1.0      2021-11-26 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  DBI             1.1.3      2022-06-18 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  dials         * 1.1.0      2022-11-04 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  DiceDesign      1.9        2021-02-13 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  digest          0.6.31     2022-12-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  doParallel      1.0.17     2022-02-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  doRNG           1.8.6      2023-01-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  dplyr         * 1.0.10     2022-09-01 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  ellipsis        0.3.2      2021-04-29 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  fansi           1.0.4      2023-01-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  farver          2.1.1      2022-07-06 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  fastmap         1.1.0      2021-01-25 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  foreach         1.5.2      2022-02-02 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  furrr           0.3.1      2022-08-15 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  future          1.30.0     2022-12-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  future.apply    1.10.0     2022-11-05 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  generics        0.1.3      2022-07-05 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  ggplot2       * 3.4.0      2022-11-04 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ggrepel         0.9.2      2022-11-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  glmnet          4.1-6      2022-11-27 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  globals         0.16.2     2022-11-21 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  glue            1.6.2      2022-02-24 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  gower           1.0.1      2022-12-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  GPfit           1.0-8      2019-02-08 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  gtable          0.3.1      2022-09-01 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  guildai         0.0.0.9001 2023-01-23 [1] local</span></span>
<span><span class="co">##  hardhat         1.2.0      2022-06-30 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  infer         * 1.0.4      2022-12-02 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  ipred           0.9-13     2022-06-02 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  iterators       1.0.14     2022-02-05 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  jsonlite        1.8.4      2022-12-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  labeling        0.4.2      2020-10-20 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  lattice         0.20-45    2021-09-22 [4] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  lava            1.7.1      2023-01-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lhs             1.1.6      2022-12-17 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lifecycle       1.0.3      2022-10-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  listenv         0.9.0      2022-12-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  lubridate       1.9.0      2022-11-06 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  magrittr        2.0.3      2022-03-30 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  MASS            7.3-58.2   2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  Matrix          1.5-3      2022-11-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  memoise         2.0.1      2021-11-26 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  modeldata     * 1.0.1      2022-09-06 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  munsell         0.5.0      2018-06-12 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  nnet            7.3-18     2022-09-28 [4] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  nortest         1.0-4      2015-07-30 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  parallelly      1.34.0     2023-01-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  parsnip       * 1.0.3      2022-11-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  pillar          1.8.1      2022-08-19 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  pkgconfig       2.0.3      2019-09-22 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  prodlim         2019.11.13 2019-11-17 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  purrr         * 1.0.1      2023-01-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  R6              2.5.1      2021-08-19 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  Rcpp            1.0.10     2023-01-22 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  recipes       * 1.0.4      2023-01-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rlang           1.0.6      2022-09-24 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  rngtools        1.5.2      2021-09-20 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rpart           4.1.19     2022-10-21 [4] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  rsample       * 1.1.1      2022-12-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  rstudioapi      0.14       2022-08-22 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  scales        * 1.2.1      2022-08-20 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  sessioninfo   * 1.2.2      2021-12-06 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  shape           1.4.6      2021-05-19 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  splines2        0.4.7      2023-01-14 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  survival        3.5-0      2023-01-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tibble        * 3.1.8      2022-07-22 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  tidymodels    * 1.0.0      2022-07-13 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tidyr         * 1.2.1      2022-09-08 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">##  tidyselect      1.2.0      2022-10-10 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  timechange      0.2.0      2023-01-11 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  timeDate        4022.108   2023-01-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  tune          * 1.0.1      2022-10-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  utf8            1.2.2      2021-07-24 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  vctrs           0.5.2      2023-01-23 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  withr           2.5.0      2022-03-03 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">##  workflows     * 1.1.2      2022-11-16 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  workflowsets  * 1.0.0      2022-07-12 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">##  yaml            2.3.6      2022-10-18 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">##  yardstick     * 1.1.0      2022-09-07 [1] RSPM (R 4.2.0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  [1] /home/tomasz/R/x86_64-pc-linux-gnu-library/4.2</span></span>
<span><span class="co">##  [2] /usr/local/lib/R/site-library</span></span>
<span><span class="co">##  [3] /usr/lib/R/site-library</span></span>
<span><span class="co">##  [4] /usr/lib/R/library</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ──────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/guild_view.html">guild_view</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can use the flags and flag constraints to run an optimizer. We
could use one of the guildai built-in optimizers, or manually define a
grid using tidymodels functions, like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use existing tidymodels code to generate a space-filling design for </span></span>
<span><span class="co"># new hyperparameter combinations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">## ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</span></span>
<span><span class="co">## ✔ broom        1.0.2      ✔ recipes      1.0.4 </span></span>
<span><span class="co">## ✔ dials        1.1.0      ✔ rsample      1.1.1 </span></span>
<span><span class="co">## ✔ dplyr        1.0.10     ✔ tibble       3.1.8 </span></span>
<span><span class="co">## ✔ ggplot2      3.4.0      ✔ tidyr        1.2.1 </span></span>
<span><span class="co">## ✔ infer        1.0.4      ✔ tune         1.0.1 </span></span>
<span><span class="co">## ✔ modeldata    1.0.1      ✔ workflows    1.1.2 </span></span>
<span><span class="co">## ✔ parsnip      1.0.3      ✔ workflowsets 1.0.0 </span></span>
<span><span class="co">## ✔ purrr        1.0.1      ✔ yardstick    1.1.0</span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">## ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">## ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">## ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="co">## • Search for functions across packages at https://www.tidymodels.org/find/</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">parameters</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pen_val <span class="op">=</span> <span class="fu">penalty</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  mix_val <span class="op">=</span> <span class="fu">mixture</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  latitude_df <span class="op">=</span> <span class="fu">spline_degree</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">50L</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  longitude_df <span class="op">=</span> <span class="fu">spline_degree</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">50L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu">grid_latin_hypercube</span><span class="op">(</span><span class="va">params</span>, size <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="va">grid</span></span>
<span><span class="co">## # A tibble: 19 × 4</span></span>
<span><span class="co">##     pen_val mix_val latitude_df longitude_df</span></span>
<span><span class="co">##       &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">##  1 1.10e- 8  0.915           21           31</span></span>
<span><span class="co">##  2 3.88e- 3  0.289           29            2</span></span>
<span><span class="co">##  3 1.11e- 7  0.996           25            5</span></span>
<span><span class="co">##  4 1.57e- 4  0.480           37           26</span></span>
<span><span class="co">##  5 1.00e- 3  0.568           47           29</span></span>
<span><span class="co">##  6 3.10e- 9  0.0644           4           12</span></span>
<span><span class="co">##  7 2.54e-10  0.841            6           37</span></span>
<span><span class="co">##  8 1.13e- 1  0.401           50           44</span></span>
<span><span class="co">##  9 6.15e- 7  0.633           15           38</span></span>
<span><span class="co">## 10 1.81e- 5  0.254           41           49</span></span>
<span><span class="co">## 11 5.81e- 5  0.363           32            7</span></span>
<span><span class="co">## 12 6.53e- 1  0.0346          19           24</span></span>
<span><span class="co">## 13 4.48e- 4  0.879           38           42</span></span>
<span><span class="co">## 14 4.15e- 2  0.613           14           13</span></span>
<span><span class="co">## 15 1.06e- 9  0.457           11           35</span></span>
<span><span class="co">## 16 1.83e- 2  0.777            8           21</span></span>
<span><span class="co">## 17 2.96e- 6  0.174           42           46</span></span>
<span><span class="co">## 18 2.81e- 8  0.690           34           16</span></span>
<span><span class="co">## 19 3.40e- 7  0.157           26           20</span></span>
<span></span>
<span><span class="co"># Launch a batch of run defined by the grid flags.</span></span>
<span><span class="fu"><a href="../../reference/guild_run.html">guild_run</a></span><span class="op">(</span></span>
<span>  <span class="st">"train-tidymodels.R"</span>,</span>
<span>  flags <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  echo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># ignore stdout *and* stderr</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Find the best run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runs_info.html">runs_info</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"train-tidymodels.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runs</span><span class="op">$</span><span class="va">scalars</span></span>
<span><span class="co">## # A tibble: 20 × 3</span></span>
<span><span class="co">##    num_predictors validation_R2 validation_rmse</span></span>
<span><span class="co">##             &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">##  1            201         0.847          0.0743</span></span>
<span><span class="co">##  2            206         0.844          0.0670</span></span>
<span><span class="co">##  3            204         0.917          0.0508</span></span>
<span><span class="co">##  4             23         0.841          0.0738</span></span>
<span><span class="co">##  5            204         0.850          0.0697</span></span>
<span><span class="co">##  6             12         0.832          0.0789</span></span>
<span><span class="co">##  7            162         0.865          0.0651</span></span>
<span><span class="co">##  8             50         0.854          0.0996</span></span>
<span><span class="co">##  9            201         0.841          0.0719</span></span>
<span><span class="co">## 10            203         0.877          0.0631</span></span>
<span><span class="co">## 11            205         0.786          0.0833</span></span>
<span><span class="co">## 12             11         0.837          0.102 </span></span>
<span><span class="co">## 13            202         0.890          0.0603</span></span>
<span><span class="co">## 14            207         0.900          0.0575</span></span>
<span><span class="co">## 15            163         0.896          0.0587</span></span>
<span><span class="co">## 16            194         0.876          0.0631</span></span>
<span><span class="co">## 17            201         0.842          0.0718</span></span>
<span><span class="co">## 18            114         0.882          0.0634</span></span>
<span><span class="co">## 19            208         0.890          0.0583</span></span>
<span><span class="co">## 20            129         0.828          0.0755</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_run</span> <span class="op">&lt;-</span> <span class="va">runs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span><span class="va">scalars</span><span class="op">$</span><span class="va">validation_rmse</span><span class="op">)</span></span></code></pre></div>
<p>Recover the fitted model and validation from the best run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_run_saved_objects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">best_run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".RData"</span><span class="op">)</span>,</span>
<span>     envir <span class="op">=</span> <span class="va">best_run_saved_objects</span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_run_saved_objects</span><span class="op">$</span><span class="va">ames_fit</span></span>
<span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## Preprocessor: Recipe</span></span>
<span><span class="co">## Model: linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 6 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## • step_other()</span></span>
<span><span class="co">## • step_orderNorm()</span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## • step_spline_natural()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">##   [[ suppressing 92 column names 's0', 's1', 's2' ... ]]</span></span>
<span><span class="co">## $a0</span></span>
<span><span class="co">##       s0       s1       s2       s3       s4       s5       s6       s7 </span></span>
<span><span class="co">## 5.218522 5.217654 5.141383 5.014386 4.773120 4.530481 4.314826 4.107660 </span></span>
<span><span class="co">##       s8       s9      s10      s11      s12      s13      s14      s15 </span></span>
<span><span class="co">## 3.906833 3.712322 3.535298 3.388675 3.248158 3.116998 3.001106 2.913377 </span></span>
<span><span class="co">##      s16      s17      s18      s19      s20      s21      s22      s23 </span></span>
<span><span class="co">## 2.832164 2.771357 2.715313 2.665678 2.622287 2.588259 2.558751 2.535047 </span></span>
<span><span class="co">##      s24      s25      s26      s27      s28      s29      s30      s31 </span></span>
<span><span class="co">## 2.513904 2.499224 2.478459 2.462802 2.456381 2.447585 2.446049 2.421178 </span></span>
<span><span class="co">##      s32      s33      s34      s35      s36      s37      s38      s39 </span></span>
<span><span class="co">## 2.403677 2.397739 2.390532 2.383002 2.374963 2.364017 2.350218 2.335342 </span></span>
<span><span class="co">##      s40      s41      s42      s43      s44      s45      s46      s47 </span></span>
<span><span class="co">## 2.315803 2.299297 2.401694 2.562162 2.714862 2.863474 3.020326 3.162124 </span></span>
<span><span class="co">##      s48      s49      s50      s51      s52      s53      s54      s55 </span></span>
<span><span class="co">## 3.304442 3.451649 3.579247 3.665573 3.747476 3.842037 3.945825 4.038163 </span></span>
<span><span class="co">##      s56      s57      s58      s59      s60      s61      s62      s63 </span></span>
<span><span class="co">## 4.128638 4.222940 4.285866 4.358876 4.420064 4.474594 4.519049 4.578983 </span></span>
<span><span class="co">##      s64      s65      s66      s67      s68      s69      s70      s71 </span></span>
<span><span class="co">## 4.618848 4.653250 4.684685 4.722390 4.763791 4.807102 4.842698 4.873765 </span></span>
<span><span class="co">##      s72      s73      s74      s75      s76      s77      s78      s79 </span></span>
<span><span class="co">## 4.910653 4.947488 4.982691 5.017765 5.050313 5.079742 5.107390 5.131346 </span></span>
<span><span class="co">##      s80      s81      s82      s83      s84      s85      s86      s87 </span></span>
<span><span class="co">## 5.153281 5.176234 5.194172 5.210404 5.225377 5.239461 5.254153 5.267496 </span></span>
<span><span class="co">##      s88      s89      s90      s91 </span></span>
<span><span class="co">## 5.281134 5.292579 5.314062 5.319247 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $beta</span></span>
<span><span class="co">## 216 x 92 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">##                                                                             </span></span>
<span><span class="co">## Lot_Frontage                                     . .            .           </span></span>
<span><span class="co">## Lot_Area                                         . .            .           </span></span>
<span><span class="co">## Year_Built                                       . .            3.502984e-05</span></span>
<span><span class="co">## Year_Remod_Add                                   . .            .           </span></span>
<span><span class="co">## Mas_Vnr_Area                                     . .            .           </span></span>
<span><span class="co">## BsmtFin_SF_1                                     . .            .           </span></span>
<span><span class="co">## BsmtFin_SF_2                                     . .            .           </span></span>
<span><span class="co">## Bsmt_Unf_SF                                      . .            .           </span></span>
<span><span class="co">## Total_Bsmt_SF                                    . .            8.093675e-04</span></span>
<span><span class="co">## First_Flr_SF                                     . .            .           </span></span>
<span><span class="co">## Second_Flr_SF                                    . .            .           </span></span>
<span><span class="co">## Gr_Liv_Area                                      . 0.0027267517 5.047359e-03</span></span>
<span><span class="co">## Bsmt_Full_Bath                                   . .            .           </span></span>
<span><span class="co">## Bsmt_Half_Bath                                   . .            .           </span></span>
<span><span class="co">## Full_Bath                                        . .            .           </span></span>
<span><span class="co">## Half_Bath                                        . .            .           </span></span>
<span><span class="co">## Bedroom_AbvGr                                    . .            .           </span></span>
<span><span class="co">## Kitchen_AbvGr                                    . .            .           </span></span>
<span><span class="co">## TotRms_AbvGrd                                    . .            .           </span></span>
<span><span class="co">## Fireplaces                                       . .            .           </span></span>
<span><span class="co">## Garage_Cars                                      . 0.0004956624 2.897431e-03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ...</span></span>
<span><span class="co">## and 10032 more lines.</span></span>
<span></span>
<span><span class="va">best_run_saved_objects</span><span class="op">$</span><span class="va">val_results</span></span>
<span><span class="co">## # A tibble: 3 × 3</span></span>
<span><span class="co">##   .metric .estimator .estimate</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">## 1 rmse    standard      0.0508</span></span>
<span><span class="co">## 2 rsq     standard      0.917 </span></span>
<span><span class="co">## 3 mae     standard      0.0367</span></span></code></pre></div>
<p>For reproducability, (or preparing to deploy a model) it can be
helpful to know some additional run metadata, like the starting random
seed or a log of which R packages were loaded during the R session. This
information is all stored under the <code>RUN_DIR/.guild</code>
directory.</p>
<p>To recover the seed:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="va">best_run</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".guild/attrs/random_seed"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seed</span></span>
<span><span class="co">## [1] 1135943621</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="co"># restore the starting seed.</span></span></code></pre></div>
<p>To access the log of R loaded packages:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">packages_loaded</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">dir</span>, <span class="st">".guild/attrs/r_packages_loaded"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">packages_loaded</span>, list.len <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## List of 100</span></span>
<span><span class="co">##  $ guildai      :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/R/x86_64-pc-linux-gnu-library/4.2/guildai"</span></span>
<span><span class="co">##   ..$ version: chr "0.0.0.9001"</span></span>
<span><span class="co">##  $ grDevices    :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/usr/lib/R/library/grDevices"</span></span>
<span><span class="co">##   ..$ version: chr "4.2.2"</span></span>
<span><span class="co">##  $ fansi        :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/R/x86_64-pc-linux-gnu-library/4.2/fansi"</span></span>
<span><span class="co">##   ..$ version: chr "1.0.4"</span></span>
<span><span class="co">##  $ assertthat   :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/R/x86_64-pc-linux-gnu-library/4.2/assertthat"</span></span>
<span><span class="co">##   ..$ version: chr "0.2.1"</span></span>
<span><span class="co">##  $ utf8         :List of 2</span></span>
<span><span class="co">##   ..$ path   : chr "/home/tomasz/R/x86_64-pc-linux-gnu-library/4.2/utf8"</span></span>
<span><span class="co">##   ..$ version: chr "1.2.2"</span></span>
<span><span class="co">##   [list output truncated]</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomasz Kalinowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
